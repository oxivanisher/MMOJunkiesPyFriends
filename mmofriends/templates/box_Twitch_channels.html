<ul id="twitchChannels" class="list-group"></ul><script type="text/javascript">
	(function () {
		function drawStreamContent( data ) {
			var onlineStreams = [];
			var offlineStreams = [];
			for (id in data.streams) {
				s = data.streams[id];
				if (s.stream) {
					onlineStreams.push(s);
				} else {
					offlineStreams.push(s);
				}
			}
			console.log("online: " + onlineStreams);
			console.log("offline: " + offlineStreams);

			// for (id in onlineStreams.concat(offlineStreams)) {
			for (id in data.streams) {
				s = data.streams[id];
				if (data.channels[id]) {
					display_name = '<img class="partner_list_icon" src="{{ url_for('get_image', imgType='network', imgId='System') }}" title="{{ box.netHandle }}" /> ' + data.channels[id].display_name;
					url = data.channels[id].url;
				} else {
					display_name = '<img class="partner_list_icon" src="{{ url_for('get_image', imgType='network', imgId=box.netHandle) }}" title="{{ box.netHandle }}" /> ' + id;
					url = "http://twitch.tv/" + id;
				}
				
				var image = "";
				var status = "text-warning";
				var glyph = "glyphicon-remove";
				if (s.stream) {
					imgUrl = s.stream.preview + "?" + new Date().getTime();
					image = "<img class='img-responsive' src='" + imgUrl + "' title='" + s.stream.game + ": " + s.status + "'/>";
					status = "text-success";
					glyph = "glyphicon-ok";
					display_name = display_name + " (" + s.stream.viewers + " viewers)";
				}
				var onclick = 'onclick="window.open(\'' + url + '\')"';
				var icon = '<span class="glyphicon ' + glyph + ' ' + status + ' pull-right" style="cursor: pointer;"></span>';
				var label = '<label class="control-label ' + status + '" for="inputSuccess1" style="cursor: pointer;">' + display_name + '</label>';
				var content = label + icon + image;

				$('#twitchChannels').append('<li class="list-group-item" ' + onclick + ' style="cursor: pointer;">' + content + '</li>');
			}
		}
		function loadTwitchChannelData() {
			var dataUrl = "{{ url_for('dashboard_method_json', netHandle=box.netHandle, methodHandle=box.handle) }}";
			$.getJSON( dataUrl ).done( function( data ) {
				$( "#twitchChannels" ).fadeOut( 100, function () {
					$('#twitchChannels').empty();
					drawStreamContent( data );
					$( "#twitchChannels" ).fadeIn( 100 );
				});
				// console.log("Twitch streams updated");
			});
		}
		loadTwitchChannelData();
		setInterval(loadTwitchChannelData, 30000 );
	})();
</script>