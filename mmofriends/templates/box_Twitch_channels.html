<ul class="list-group twitchChannels"></ul><script type="text/javascript">
	(function () {
		function loadTwitchChannelData() {

			var dataUrl = "{{ url_for('dashboard_method_json', netHandle=box.netHandle, methodHandle=box.handle) }}";

			$.getJSON( dataUrl ).done( function( data ) {
				$('.twitchChannels').empty();

				for (id in data.streams.sort(function(a, b) { 
						console.log(a.stream)
						if (a.stream) {
							return a.updated_at - b.updated_at;
						}
					})) {
					s = data.streams[id];
					if (data.channels[id]) {
						display_name = "MMO's " + data.channels[id].display_name;
						url = data.channels[id].url;
					} else {
						display_name = id;
						url = "http://twitch.tv/" + display_name;
					}
					
					var image = "";
					var status = "text-warning";
					var glyph = "glyphicon-remove"
					if (s.stream) {
						image = "<img class='img-responsive' src='" + s.stream.preview + "' title='" + s.stream.game + ": " + s.status + "'/>";
						status = "text-success";
						glyph = "glyphicon-ok";
						display_name = display_name + " (" + s.stream.viewers + " viewers)"
					}

					var icon = "<span class='glyphicon " + glyph + " " + status + " pull-right'></span>";
					var label = "<label class='control-label " + status + "' for='inputSuccess1'>" + display_name + "</label>";
					var content = label + icon + image;

					$('<li class="list-group-item" onclick="window.open(\'' + url + '\')" style="cursor: pointer;">' + content + '</li>').appendTo('ul.twitchChannels');
				}
				console.log("Twitch streams updated");
			});
		}
		loadTwitchChannelData();
		setInterval(loadTwitchChannelData, 30000 );
	})();
</script>